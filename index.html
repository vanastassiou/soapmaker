<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soap Recipe Builder</title>
    <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&family=Fraunces:wght@400;500&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="container">
        <header>
            <h1>Soap Recipe Builder</h1>
            <nav class="header-nav">
                <a href="index.html" class="header-link" aria-current="page">Recipe builder</a>
                <a href="pages/soapmaking/" class="header-link">Soapmaking</a>
                <a href="pages/how-it-works/" class="header-link">How it works</a>
                <a href="pages/references.html" class="header-link">References</a>
                <a href="https://ko-fi.com/arkavia" target="_blank" rel="noopener" class="kofi-button" title="Ko-fi: Buy me a slice of babka?">
                    <svg class="kofi-icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                        <path d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604 0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407 0 0 1.565-1.782 3.468-.963 1.904.82 1.832 3.011.723 4.311z"/>
                    </svg>
                    Buy me a slice of babka?
                </a>
            </nav>
        </header>

        <main id="main-content" class="main-grid">
            <div class="left-column">
                <!-- Build Recipe -->
                <div class="card" id="buildRecipeCard">
                    <div class="card-header">
                        <h2 class="card-title">Build recipe</h2>
                        <div class="recipe-actions">
                            <button class="btn btn-secondary btn-small" id="startOverBtn">Start over</button>
                        </div>
                    </div>
                    <ol class="instructions">
                        <li>Adjust settings</li>
                        <li>Add fats</li>
                        <li>Click <strong>Create Recipe</strong> below</li>
                    </ol>

                    <!-- Settings Subcontainer -->
                    <details class="build-subcontainer" id="settingsSection" open>
                        <summary class="collapsible-header">
                            <span class="collapse-icon" aria-hidden="true"></span>
                            <h3 class="subcontainer-title">Recipe settings</h3>
                            <button class="btn btn-text btn-small reset-btn" id="resetSettingsBtn">Reset</button>
                        </summary>
                        <div class="collapsible-content" id="settingsContent">
                        <div class="settings-row">
                            <div class="form-group">
                                <div class="label-row">
                                    <label for="lyeType">Lye type</label>
                                    <span class="help-tip" id="lyeTypeHelp" data-term="lye-type" aria-label="More info about lye type">ⓘ</span>
                                </div>
                                <select id="lyeType" aria-describedby="lyeTypeHelp">
                                    <option value="NaOH">NaOH (Sodium Hydroxide)</option>
                                    <option value="KOH">KOH (Potassium Hydroxide)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <div class="label-row">
                                    <label for="processType">Process</label>
                                    <span class="help-tip" id="processTypeHelp" data-term="process-type" aria-label="More info about soap process">ⓘ</span>
                                </div>
                                <select id="processType" aria-describedby="processTypeHelp">
                                    <option value="cold">Cold process</option>
                                    <option value="hot">Hot process</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <div class="label-row">
                                    <label for="superfat">Superfat %</label>
                                    <span class="help-tip" id="superfatHelp" data-term="superfat" aria-label="More info about superfat">ⓘ</span>
                                </div>
                                <input type="number" id="superfat" value="5" min="0" max="20" step="1" aria-describedby="superfatHelp">
                            </div>
                            <div class="form-group">
                                <div class="label-row">
                                    <label for="waterRatio">Water-to-lye ratio</label>
                                    <span class="help-tip" id="waterRatioHelp" data-term="lye-concentration" aria-label="More info about water ratio">ⓘ</span>
                                </div>
                                <input type="number" id="waterRatio" value="2" min="1.5" max="3" step="0.1" aria-describedby="waterRatioHelp">
                            </div>
                            <div class="form-group">
                                <label for="unit">Unit</label>
                                <select id="unit">
                                    <option value="g">Grams</option>
                                    <option value="oz">Ounces</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <div class="label-row">
                                    <label for="recipeWeight">Recipe weight</label>
                                    <span class="help-tip" id="recipeWeightHelp" data-term="recipe-weight" aria-label="More info about recipe weight">ⓘ</span>
                                </div>
                                <input type="number" id="recipeWeight" value="500" min="100" step="10" aria-describedby="recipeWeightHelp">
                            </div>
                        </div>

                        </div>
                    </details>

                    <!-- Exclusions Subcontainer -->
                    <details class="build-subcontainer" id="exclusionsSection">
                        <summary class="collapsible-header">
                            <span class="collapse-icon" aria-hidden="true"></span>
                            <h3 class="subcontainer-title">Exclusions <span class="optional-label">(optional)</span></h3>
                            <button class="btn btn-text btn-small reset-btn" id="resetExclusionsBtn">Reset</button>
                        </summary>
                        <div class="collapsible-content" id="exclusionsContent">
                            <div class="dietary-filters" id="dietaryFiltersSection">
                                <label class="dietary-filter">
                                    <input type="checkbox" id="filterAnimalBased">
                                    <span>Animal based</span>
                                    <span class="ui-tip" data-tooltip="filter-animal" aria-label="What does this filter?">ⓘ</span>
                                </label>
                                <label class="dietary-filter">
                                    <input type="checkbox" id="filterSourcingConcerns">
                                    <span>Sourcing concerns</span>
                                    <span class="ui-tip" data-tooltip="sourcing-concerns" aria-label="What does this filter?">ⓘ</span>
                                </label>
                                <label class="dietary-filter">
                                    <input type="checkbox" id="filterCommonAllergens">
                                    <span>Common allergens</span>
                                    <span class="ui-tip" data-tooltip="filter-allergens" aria-label="What does this filter?">ⓘ</span>
                                </label>
                            </div>
                            <div class="fat-selector">
                                <select id="excludeIngredientSelect">
                                    <option value="">Select specific ingredient to exclude...</option>
                                </select>
                                <button class="btn" id="addExclusionBtn">Add</button>
                            </div>
                            <div class="excluded-ingredients-list" id="excludedIngredientsList">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </details>

                    <!-- Fats subcontainer -->
                    <details class="build-subcontainer" id="fatsSection" open>
                        <summary class="collapsible-header">
                            <span class="collapse-icon" aria-hidden="true"></span>
                            <h3 class="subcontainer-title">Add fats</h3>
                            <button class="btn btn-text btn-small reset-btn" id="resetFatsBtn">Reset</button>
                        </summary>
                        <div class="collapsible-content" id="fatsContent">
                        <!-- Build Mode Area (unified container) -->
                        <div class="mode-area">
                            <!-- Build Mode tabs -->
                            <div class="tabs build-mode-tabs" role="tablist" aria-label="Recipe build mode">
                                <button class="tab build-mode-tab active" data-mode="fats" role="tab" aria-selected="true" aria-controls="selectFatsMode" id="tab-fats">Select fats</button>
                                <button class="tab build-mode-tab" data-mode="properties" role="tab" aria-selected="false" aria-controls="specifyPropertiesMode" id="tab-properties">Specify properties</button>
                                <button class="tab build-mode-tab" data-mode="cupboard" role="tab" aria-selected="false" aria-controls="cupboardCleanerMode" id="tab-cupboard">Cupboard cleaner</button>
                                <button class="tab build-mode-tab" data-mode="yolo" role="tab" aria-selected="false" aria-controls="yoloMode" id="tab-yolo">YOLO</button>
                            </div>

                            <!-- Mode helper text -->
                            <p class="build-mode-helper" id="fatsDescription">Choose fats to use in your recipe. You can lock fats at specified percentages while you tweak others around it.</p>
                            <p class="build-mode-helper hidden" id="propertiesDescription">Enter the soap properties you want to aim for and find fats to match.</p>
                            <p class="build-mode-helper hidden" id="yoloDescription">Lock fats you like and regenerate the rest for new ideas and inspiration.</p>
                            <p class="build-mode-helper hidden" id="cupboardDescription">Enter the fats you already have and how much of each you want to use. Get suggestions for additional fats to create a balanced soap.</p>

                        <!-- Select Fats mode -->
                        <div class="build-mode-content" id="selectFatsMode" role="tabpanel" aria-labelledby="tab-fats">
                            <div class="fat-selector">
                                <select id="fatSelect">
                                    <option value="">Select a fat to add...</option>
                                </select>
                                <button class="btn" id="addFatBtn">Add</button>
                            </div>

                            <div class="recipe-fats" id="recipeFats">
                                <div class="empty-state-small">
                                    <p>No fats added</p>
                                </div>
                            </div>
                            <div class="use-recipe-action hidden" id="useFatsAction">
                                <button class="btn" id="useFatsBtn">Use these fats</button>
                            </div>
                        </div>

                        <!-- Specify Properties mode -->
                        <div class="build-mode-content hidden" id="specifyPropertiesMode" role="tabpanel" aria-labelledby="tab-properties">
                            <div class="property-header">
                                <div class="property-options">
                                    <label for="maxFats">Max different fats <select id="maxFats">
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5" selected>5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                    </select><span class="ui-tip" data-tooltip="max-fats" aria-label="What does max fats do?">ⓘ</span></label>
                                    <label><input type="checkbox" id="includeCastor">Include castor oil<span class="help-tip" data-term="castor-oil" aria-label="More info about castor oil">ⓘ</span></label>
                                </div>
                            </div>

                            <div class="property-list">
                                <div class="property-row">
                                    <button type="button" class="info-link" data-term="hardness" id="hardnessLabel">Hardness</button>
                                    <input type="number" id="targetHardness" min="0" max="100" placeholder="29-54" aria-labelledby="hardnessLabel">
                                </div>
                                <div class="property-row">
                                    <button type="button" class="info-link" data-term="degreasing" id="degreasingLabel">Grease removing</button>
                                    <input type="number" id="targetDegreasing" min="0" max="100" placeholder="12-22" aria-labelledby="degreasingLabel">
                                </div>
                                <div class="property-row">
                                    <button type="button" class="info-link" data-term="moisturizing" id="moisturizingLabel">Skin conditioning</button>
                                    <input type="number" id="targetMoisturizing" min="0" max="100" placeholder="44-69" aria-labelledby="moisturizingLabel">
                                </div>
                                <div class="property-row">
                                    <button type="button" class="info-link" data-term="lather-volume" id="latherVolumeLabel">Lather volume</button>
                                    <input type="number" id="targetLatherVolume" min="0" max="100" placeholder="14-46" aria-labelledby="latherVolumeLabel">
                                </div>
                                <div class="property-row">
                                    <button type="button" class="info-link" data-term="lather-density" id="latherDensityLabel">Lather density</button>
                                    <input type="number" id="targetLatherDensity" min="0" max="100" placeholder="16-48" aria-labelledby="latherDensityLabel">
                                </div>
                            </div>

                            <div class="generate-action">
                                <button class="btn" id="generateRecipeBtn">Generate</button>
                            </div>

                            <div class="profile-results hidden" id="profileResults">
                                <div class="match-quality" id="matchQuality">
                                    <span class="match-label">Match Quality:</span>
                                    <div class="match-bar">
                                        <div class="match-bar-fill" id="matchBarFill"></div>
                                    </div>
                                    <span class="match-percent" id="matchPercent">0%</span>
                                </div>

                                <div class="suggested-recipe" id="suggestedRecipe">
                                    <!-- Populated by JS -->
                                </div>

                                <div class="achieved-profile" id="achievedProfile">
                                    <h4>Target vs achieved:</h4>
                                    <div class="achieved-comparison" id="achievedComparison">
                                        <!-- Populated by JS -->
                                    </div>
                                </div>

                                <div class="use-recipe-action">
                                    <button class="btn" id="useRecipeBtn">Use these fats</button>
                                </div>
                            </div>
                        </div>

                        <!-- YOLO Mode -->
                        <div class="build-mode-content hidden" id="yoloMode" role="tabpanel" aria-labelledby="tab-yolo">
                            <div class="generate-action">
                                <button class="btn" id="yoloBtn" aria-describedby="yoloDescription">Surprise me!</button>
                            </div>
                            <div class="recipe-fats" id="yoloRecipeFats">
                                <!-- Populated by JS after generation -->
                            </div>
                            <div class="use-recipe-action hidden" id="useYoloRecipeAction">
                                <button class="btn" id="useYoloRecipeBtn">Use these fats</button>
                            </div>
                        </div>

                        <!-- Cupboard Cleaner Mode -->
                        <div class="build-mode-content hidden" id="cupboardCleanerMode" role="tabpanel" aria-labelledby="tab-cupboard">
                            <!-- Your fats section -->
                            <div class="mode-subcontainer">
                                <h4 class="mode-subcontainer-title">Your fats</h4>
                                <label class="ratio-mode-toggle">
                                    <input type="checkbox" id="allowRatioSuggestions">
                                    <span>Allow ratio adjustments</span>
                                </label>
                                <div class="fat-selector">
                                    <select id="cupboardFatSelect">
                                        <option value="">Select fat you have...</option>
                                    </select>
                                    <button class="btn" id="addCupboardFatBtn">Add</button>
                                </div>
                                <div class="recipe-fats" id="cupboardFats">
                                    <div class="empty-state-small">
                                        <p>No fats added</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Suggestions section -->
                            <div class="generate-action">
                                <button class="btn" id="cupboardCleanerBtn">Get suggestions</button>
                            </div>
                            <div class="recipe-fats" id="cupboardSuggestions">
                                <!-- Populated by JS -->
                            </div>

                            <div class="use-recipe-action hidden" id="useCupboardAction">
                                <button class="btn" id="useCupboardBtn">Use this recipe</button>
                            </div>
                        </div>
                        </div><!-- End mode-area -->

                        <!-- Properties display (visible in all build modes) -->
                        <div class="mode-area" id="buildModeProperties">
                            <h4 class="mode-area-title">Qualitative properties</h4>
                            <p class="analysis-helper-text">These numbers predict how your soap will feel and perform.</p>
                            <table class="analysis-table properties-table" aria-label="Soap properties analysis">
                                <thead>
                                    <tr>
                                        <th scope="col">Property</th>
                                        <th scope="col" class="range-col">Range</th>
                                        <th scope="col" class="value-col">Recipe</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><button type="button" class="info-link" data-term="hardness">Hardness</button></td>
                                        <td class="range-col" id="rangeHardness">--</td>
                                        <td class="value-col" id="propHardness">0</td>
                                    </tr>
                                    <tr>
                                        <td><button type="button" class="info-link" data-term="degreasing">Grease removing</button></td>
                                        <td class="range-col" id="rangeDegreasing">--</td>
                                        <td class="value-col" id="propDegreasing">0</td>
                                    </tr>
                                    <tr>
                                        <td><button type="button" class="info-link" data-term="moisturizing">Skin conditioning</button></td>
                                        <td class="range-col" id="rangeMoisturizing">--</td>
                                        <td class="value-col" id="propMoisturizing">0</td>
                                    </tr>
                                    <tr>
                                        <td><button type="button" class="info-link" data-term="lather-volume">Lather volume</button></td>
                                        <td class="range-col" id="rangeLatherVolume">--</td>
                                        <td class="value-col" id="propLatherVolume">0</td>
                                    </tr>
                                    <tr>
                                        <td><button type="button" class="info-link" data-term="lather-density">Lather density</button></td>
                                        <td class="range-col" id="rangeLatherDensity">--</td>
                                        <td class="value-col" id="propLatherDensity">0</td>
                                    </tr>
                                    <tr>
                                        <td><button type="button" class="info-link" data-term="iodine">Iodine value</button></td>
                                        <td class="range-col" id="rangeIodine">--</td>
                                        <td class="value-col" id="propIodine">0</td>
                                    </tr>
                                    <tr>
                                        <td><button type="button" class="info-link" data-term="ins">INS</button></td>
                                        <td class="range-col" id="rangeIns">--</td>
                                        <td class="value-col" id="propIns">0</td>
                                    </tr>
                                </tbody>
                                </table>
                        </div><!-- End properties mode-area -->
                        </div>
                    </details>

                    <!-- Additives subcontainer -->
                    <details class="build-subcontainer" id="additivesSubcontainer" open>
                        <summary class="collapsible-header">
                            <span class="collapse-icon" aria-hidden="true"></span>
                            <h3 class="subcontainer-title">Select additives <span class="optional-label">(optional)</span></h3>
                            <button class="btn btn-text btn-small reset-btn" id="resetAdditivesBtn">Reset</button>
                        </summary>
                        <div class="collapsible-content" id="additivesContent">
                            <div class="mode-area">
                                <div class="tabs additive-tabs" role="tablist" aria-label="Additive category">
                                    <button class="tab additive-tab active" data-category="fragrance" role="tab" aria-selected="true" aria-controls="additiveSelectorPanel">Fragrances</button>
                                    <button class="tab additive-tab" data-category="colourant" role="tab" aria-selected="false" aria-controls="additiveSelectorPanel">Colourants</button>
                                    <button class="tab additive-tab" data-category="soap-performance" role="tab" aria-selected="false" aria-controls="additiveSelectorPanel">Soap performance</button>
                                    <button class="tab additive-tab" data-category="skin-care" role="tab" aria-selected="false" aria-controls="additiveSelectorPanel">Skin care</button>
                                </div>

                                <div class="additive-selector" id="additiveSelectorPanel" role="tabpanel" aria-label="Additive selection">
                                    <select id="additiveSelect">
                                        <option value="">Select an additive...</option>
                                    </select>
                                    <button class="btn" id="addAdditiveBtn">Add</button>
                                </div>

                                <div class="recipe-additives" id="recipeAdditives">
                                    <div class="empty-state empty-state-small">
                                        <p>No additives</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </details>

                    <!-- Create Recipe button -->
                    <div class="create-recipe-section">
                        <button class="btn btn-primary btn-large" id="createRecipeBtn">Create Recipe</button>
                    </div>
                </div>

                <!-- Final recipe display -->
                <div class="card hidden" id="finalRecipeCard">
                    <div class="card-header">
                        <h2 class="card-title">Your recipe</h2>
                    </div>
                    <div class="final-recipe-content" id="finalRecipeContent">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Shared Panel Overlay -->
    <div class="panel-overlay" id="panelOverlay"></div>

    <!-- Glossary Info Panel -->
    <div class="info-panel" id="glossaryPanel" role="dialog" aria-modal="true" aria-labelledby="glossaryPanelName">
        <button class="close-panel" aria-label="Close panel">×</button>
        <h3 class="panel-title" id="glossaryPanelName" tabindex="-1">Term</h3>
        <div class="panel-subtitle" id="glossaryPanelCategory">category</div>

        <div class="panel-section">
            <h4>Description</h4>
            <p class="panel-description" id="glossaryPanelDesc"></p>
        </div>

        <div class="panel-section" id="glossaryDetailsSection">
            <h4>Details</h4>
            <p class="panel-description" id="glossaryPanelDetails"></p>
        </div>

        <div class="panel-section" id="glossaryContributorsSection">
            <h4>Contributing fats in recipe</h4>
            <div class="fa-sources" id="glossaryPanelContributors"></div>
        </div>

        <div class="panel-section" id="glossaryRelatedSection">
            <h4>Related</h4>
            <div class="panel-tags" id="glossaryPanelRelated"></div>
        </div>

    </div>

    <!-- Fat Info Panel -->
    <div class="info-panel" id="fatInfoPanel" role="dialog" aria-modal="true" aria-labelledby="fatPanelName">
        <button class="close-panel" aria-label="Close panel">×</button>
        <h3 class="panel-title" id="fatPanelName" tabindex="-1">Fat name</h3>
        <div class="panel-subtitle" id="fatPanelSap">NaOH SAP: 0.000 | KOH SAP: 0.000</div>

        <div class="panel-section">
            <h4>Recommended usage</h4>
            <span class="panel-usage" id="fatPanelUsage">0 to 0% of total recipe fats</span>
        </div>

        <div class="panel-section">
            <h4>Description</h4>
            <p class="panel-description" id="fatPanelDescription"></p>
        </div>

        <div class="panel-section">
            <h4>Contributions to soap</h4>
            <p class="panel-description" id="fatPanelProperties"></p>
        </div>

        <div class="panel-section">
            <h4>Fatty acid composition</h4>
            <div class="fa-sources" id="fatPanelFattyAcids"></div>
        </div>

    </div>

    <!-- Fatty Acid Info Panel -->
    <div class="info-panel" id="fattyAcidPanel" role="dialog" aria-modal="true" aria-labelledby="faName">
        <button class="close-panel" id="closeFattyAcidPanel" aria-label="Close panel">×</button>
        <h3 class="panel-title" id="faName" tabindex="-1">Fatty acid name</h3>
        <div class="panel-subtitle" id="faFormula">C12:0 · Saturated</div>

        <div class="panel-section">
            <h4>Chemistry</h4>
            <div class="fa-chemistry" id="faChemistry"></div>
        </div>

        <div class="panel-section">
            <h4>Soap contribution</h4>
            <p class="panel-description" id="faContribution"></p>
        </div>

        <div class="panel-section">
            <h4>In your recipe</h4>
            <div class="fa-sources" id="faRecipeSources">
                <p class="no-sources">No fats in your recipe contain this fatty acid</p>
            </div>
        </div>

        <div class="panel-section">
            <h4>Common sources</h4>
            <div class="fa-common-sources" id="faCommonSources"></div>
        </div>

    </div>

    <!-- Additive Info Panel -->
    <div class="info-panel" id="additiveInfoPanel" role="dialog" aria-modal="true" aria-labelledby="additivePanelName">
        <button class="close-panel" aria-label="Close panel">×</button>
        <h3 class="panel-title" id="additivePanelName" tabindex="-1">Additive name</h3>
        <div class="panel-subtitle" id="additivePanelCategory">Category</div>

        <div class="panel-section">
            <h4>Recommended usage</h4>
            <span class="panel-usage" id="additivePanelUsage">0% to 0% of fat weight</span>
        </div>

        <div class="panel-section">
            <h4>Description</h4>
            <p class="panel-description" id="additivePanelDescription"></p>
        </div>

        <div class="panel-section" id="additivePanelSafetySection">
            <h4>Safety</h4>
            <div class="panel-safety" id="additivePanelSafety"></div>
        </div>

        <div class="panel-section" id="additivePanelExtraSection">
            <div id="additivePanelExtra"></div>
        </div>

    </div>

    <script src="./js/vendor/ajv.min.js"></script>
    <script type="module" src="./js/main.js"></script>
</body>
</html>
