{
  "$id": "common-definitions.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Common Schema Definitions",
  "description": "Shared definitions for soap additive schemas",
  "definitions": {
    "dietary": {
      "additionalProperties": false,
      "description": "Dietary classification flags",
      "properties": {
        "animalBased": {
          "description": "True if derived from animal sources",
          "type": "boolean"
        },
        "commonAllergen": {
          "description": "True if associated with common allergens",
          "type": "boolean"
        }
      },
      "type": "object"
    },
    "sourcing": {
      "additionalProperties": false,
      "description": "Sourcing and production information",
      "properties": {
        "primaryRegions": {
          "description": "Primary countries or regions where this ingredient is produced",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "type": "array"
        },
        "productionMethod": {
          "description": "How the ingredient is extracted or produced",
          "type": "string"
        },
        "supplyChainNotes": {
          "description": "Additional notes about supply chain specifics",
          "type": "string"
        }
      },
      "required": ["primaryRegions", "productionMethod"],
      "type": "object"
    },
    "ethicalConcerns": {
      "additionalProperties": false,
      "description": "Ethical and sustainability concerns",
      "properties": {
        "environmental": {
          "description": "Environmental impact concerns",
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "social": {
          "description": "Social and labour-related concerns",
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "political": {
          "description": "Political or conflict-related concerns",
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "certifications": {
          "description": "Available certifications to address concerns",
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "notes": {
          "description": "Additional context about ethical considerations",
          "type": "string"
        }
      },
      "required": ["environmental", "social", "political", "certifications", "notes"],
      "type": "object"
    },
    "usage": {
      "additionalProperties": false,
      "description": "Recommended usage range",
      "properties": {
        "basis": {
          "description": "What the percentage is calculated from",
          "enum": ["oil-weight", "batch-weight"],
          "type": "string"
        },
        "min": {
          "description": "Minimum recommended percentage",
          "maximum": 100,
          "minimum": 0,
          "type": "number"
        },
        "max": {
          "description": "Maximum recommended percentage",
          "maximum": 100,
          "minimum": 0,
          "type": "number"
        }
      },
      "required": ["min", "max", "basis"],
      "type": "object"
    },
    "reference": {
      "additionalProperties": false,
      "description": "Reference to a source document",
      "properties": {
        "sourceId": {
          "type": "string",
          "minLength": 1,
          "description": "ID of source in sources.json"
        },
        "section": {
          "type": "string",
          "description": "Specific section, chapter, or article identifier"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Direct URL to the referenced content"
        },
        "note": {
          "type": "string",
          "description": "Additional context about this specific reference"
        }
      },
      "required": ["sourceId", "section"],
      "type": "object"
    },
    "references": {
      "description": "Array of source references",
      "items": {
        "$ref": "#/definitions/reference"
      },
      "minItems": 1,
      "type": "array"
    },
    "casNumber": {
      "description": "CAS registry number",
      "pattern": "^[0-9]+-[0-9]+-[0-9]+$",
      "type": "string"
    },
    "maxConcentration": {
      "description": "Maximum safe concentration %",
      "maximum": 100,
      "minimum": 0,
      "type": "number"
    },
    "safety": {
      "additionalProperties": false,
      "description": "Safety information",
      "properties": {
        "casNumber": {
          "$ref": "#/definitions/casNumber"
        },
        "maxConcentration": {
          "$ref": "#/definitions/maxConcentration"
        }
      },
      "type": "object"
    }
  }
}
